<!DOCTYPE html>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<style>
	.axis {
	  font: 10px sans-serif;
	}

	.axis path,
	.axis line {
	  fill: none;
	  stroke: #000;
	  shape-rendering: crispEdges;
	}
	.d3-tip:after {
	  box-sizing: border-box;
	  display: inline;
	  font-size: 10px;
	  width: 100%;
	  line-height: 1;
	  color: rgba(0, 0, 0, 0.8);
	  content: "\25BC";
	  position: absolute;
	  text-align: center;
	}
	.d3-tip.n:after {
	  margin: -1px 0 0 0;
	  top: 100%;
	  left: 0;
</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="http://d3js.org/queue.v1.min.js"></script>
<h1> 
	Report on User Generated Reviews in Yelp Dataset 
</h1>
<p> 
	Yelp is a company helping people find great local businesses like restaurants, dentists and hair stylists. Yelp dataset is user generated data including business 	information, user information and user reviews about different business. 
</p>
<p>
	The most significant part of a business in the dataset is its user-generated star ratings and reviews. The 1-5 star based rating in each review can provide reader 	with a brief overview about a certain business. Many people do not read each review in detail so rating is always considered as the most important part of a 		review. Here is an overview of user generated ratings.
</p>
<div id= 'generalView'> 
	
</div>
<p>
	Reviews are generated by users. Different users may have distinct rating standards. A strict rater will be likely to give 1 star to a business he or she is not 	satisfied with service provided while a nicer user may choose 2 or 3 stars. However, the reviews they wrote about that business has more chances to be similar if 	they share the same feeling. So, there are stories to tell if we could let review texts tell us how the user feels about the business. We may generate a star 		rating using a businessâ€™s review text alone to relieve ratings from subjectivity and reduce bias from reviewers.
</p>
<p>
	Natural language processing (NLP) is required to obtain useful information from reviews as they are written by humans. First, let's see some interesting facts 		about user generated texts. 
</p>
<p> 
	To distinguish ratings from texts, we first need to determine which part of text we use. If we look into top frequent words in all review texts, we can find their 	distributions in different ratings as below:
</p>
<div id="top5freqword"> </div>
<p>
	As we can see, all top 5 frequent words are adverbs and their percentage in each rating is very close to the percentage of each rating in al reviews. We use them 	everywhere so it will be meaningless if we use them to determine star ratings. But, let's take a look at these two adjectives, 'horrible' and 'great':
</p>
<div id="top5adj"></div>
<p>
	It is intuitive that adjectives express more emotions. So we will focus on adjectives when determining star ratings based on text. Detailed information about 		adjectives appear in all reviews are shown here:
</p>
<div id="adjDistribution"></div>
<p>
	We used naive Bayes classifier with emphasis on adjectives to determine a star rating based on each review text. There are some interesting facts about our 		prediction. Let's first see how well our prediction works for different ratings:
</p>
<div id="ratings"></div>
<p>
	A heat map may show clearly how our prediction works in each region. We can see clearly that our prediction works best for 1 star and 5 star ratings. 
</p>

<script>
	var margin = {top: 30, right: 20, bottom: 70, left: 70},
	    width = 600 - margin.left - margin.right,
	    height = 300 - margin.top - margin.bottom;
	
	var x = d3.scale.ordinal().rangeRoundBands([0, width], .05);
	
	var y = d3.scale.linear().range([height, 0]);
	
	var xAxis = d3.svg.axis()
	    .scale(x)
	    .orient("bottom");
	
	var yAxis = d3.svg.axis()
	    .scale(y)
	    .orient("left")
	    .ticks(10);
	
	var svg = d3.select("#generalView").append("svg")
	    .attr("width", width + margin.left + margin.right)
	    .attr("height", height + margin.top + margin.bottom)
		.append("g")
	    	.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
	    	
	var xCat = 'Star';
	var yCat = 'Total';
	
	        
		
	d3.csv("./data/data.csv", function(error, data) {
	
	    data.forEach(function(d) {
	        d.Total = +d.Total;
	    });
		var tip = d3.tip()
			.attr("class", "d3-tip")
			.offset([-10, 0])
			.html(function(d) {
				return xCat + ": " + d[xCat] + "<br>" + yCat + ": " + d[yCat];
			});
			
		svg.call(tip);		
		x.domain(data.map(function(d) { return d.Star; }));
		y.domain([0, d3.max(data, function(d) { return d.Total; })]);
	
		svg.append("g")
	    	.attr("class", "x axis")
			.attr("transform", "translate(0," + height + ")")
			.call(xAxis)
			.selectAll("text")
				.style("text-anchor", "end")
				.attr("dx", "-.8em")
				.attr("dy", "-.55em")
				.attr("transform", "rotate(-90)" );
				
	    svg.append("text")
	        .attr("class", "x label")
	        .attr("text-anchor", "middle")
	        .attr("x", width/2)
	        .attr("y", height + margin.bottom-30)
	        .text("Stars");
			
		svg.append("g")
	      	.attr("class", "y axis")
		  	.call(yAxis)
		  	.append("text")
		  		.attr("transform", "rotate(-90)")
		  		.attr("y", 6)
		  		.attr("dy", ".71em")
		  		.style("text-anchor", "end")
		  		.text("Number of Reviews");
	
		svg.selectAll("bar")
	    	.data(data)
			.enter().append("rect")
				.style("fill", "steelblue")
				.attr("x", function(d) { return x(d.Star); })
				.attr("width", x.rangeBand())
				.attr("y", function(d) { return y(d.Total); })
				.attr("height", function(d) { return height - y(d.Total); })
				.on("mouseover", tip.show)
				.on("mouseout", tip.hide);

	
	});

</script>
</body>
</html>
